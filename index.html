<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reinvent Your Revolution</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
    <style>
        .fancy-text {
            font-family: 'Permanent Marker', cursive;
        }
    </style>
</head>
<body class="bg-gradient-to-r from-purple-500 to-pink-500 min-h-screen p-8">
    <div class="max-w-2xl mx-auto">
        <!-- Add logout button -->
        <div class="flex justify-end mb-4">
            <button onclick="logout()" 
                    class="bg-white text-purple-600 px-4 py-2 rounded-lg hover:bg-gray-100">
                Logout
            </button>
        </div>

        <!-- Title with lightning emoji -->
        <h1 class="text-center fancy-text mb-8 text-white flex items-center justify-center gap-2 text-2xl sm:text-3xl md:text-4xl">
            <span>‚ö°Ô∏è</span>
            <span>Reinvent Your Revolution</span>
            <span>‚ö°Ô∏è</span>
        </h1>

        <!-- Goal input section -->
        <div class="bg-white rounded-lg p-6 mb-8 shadow-lg">
            <input type="text" id="revolutionGoal" 
                   class="w-full p-3 border rounded-lg mb-4" 
                   placeholder="Enter your revolution goal">
            <button onclick="setGoal()" 
                    class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
                Set Goal
            </button>
        </div>

        <!-- Emoji face -->
        <div id="emojiContainer" class="text-center text-8xl mb-8 hidden">
            <div id="emojiFace">üò¢</div>
            <div id="progressText" class="text-white text-xl mt-4"></div>
        </div>

        <!-- Tasks section -->
        <div id="tasksContainer" class="hidden">
            <div class="bg-white rounded-lg p-6 shadow-lg">
                <div id="tasksList"></div>
                <button onclick="addTask()" 
                        id="addTaskBtn" 
                        class="w-full bg-green-600 text-white py-2 rounded-lg mt-4 hover:bg-green-700">
                    Add Task
                </button>
            </div>
        </div>
    </div>

    <script>
        // Add these functions at the beginning of your script section
        function checkAuth() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'signup.html';
            }
            return currentUser;
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'signup.html';
        }

        // Add this line at the beginning of your script section
        const currentUser = checkAuth();

        let tasks = [];
        let completedGoals = [];
        const MAX_INITIAL_TASKS = 2;
        let currentRevolutionNumber = 1;

        function setGoal() {
            const goal = document.getElementById('revolutionGoal').value;
            if (goal.trim() === '') return;
            
            // Update user's vision
            let users = JSON.parse(localStorage.getItem('users') || '[]');
            const userIndex = users.findIndex(u => u.username === currentUser);
            if (userIndex !== -1) {
                users[userIndex].vision = goal;
                localStorage.setItem('users', JSON.stringify(users));
            }
            
            document.getElementById('emojiContainer').classList.remove('hidden');
            document.getElementById('tasksContainer').classList.remove('hidden');
            document.getElementById('revolutionGoal').disabled = true;
            updateEmoji();
        }

        function addTask() {
            if (tasks.length >= MAX_INITIAL_TASKS && !canAddNewTask()) {
                alert('Complete at least one task to 100% before adding a new one!');
                return;
            }

            const taskHtml = `
                <div class="task mb-4 p-4 border rounded-lg">
                    <input type="text" 
                           class="w-full p-2 border rounded mb-2" 
                           placeholder="Enter task description">
                    <div class="flex items-center">
                        <select class="w-24 p-2 border rounded"
                                onchange="updateProgress(this)">
                            <option value="0">0%</option>
                            <option value="20">20%</option>
                            <option value="40">40%</option>
                            <option value="60">60%</option>
                            <option value="80">80%</option>
                            <option value="100">100%</option>
                        </select>
                    </div>
                </div>
            `;
            
            document.getElementById('tasksList').insertAdjacentHTML('beforeend', taskHtml);
            tasks.push({ progress: 0 });
            updateAddTaskButton();
        }

        function updateProgress(input) {
            const taskDiv = input.closest('.task');
            const taskIndex = Array.from(taskDiv.parentNode.children).indexOf(taskDiv);
            const newProgress = parseInt(input.value) || 0;
            
            tasks[taskIndex] = { progress: newProgress };
            
            if (newProgress === 100) {
                moveTaskToDone(taskDiv, taskIndex);
                checkRevolutionComplete();
            }
            
            updateEmoji();
            updateAddTaskButton();
        }

        function moveTaskToDone(taskDiv, taskIndex) {
            const taskDescription = taskDiv.querySelector('input[type="text"]').value;
            const doneTaskHtml = `
                <div class="task mb-4 p-4 border rounded-lg bg-gray-100">
                    <div class="text-gray-700">${taskDescription}</div>
                    <div class="flex items-center">
                        <span class="text-green-600 font-bold">Completed 100%</span>
                        <span class="ml-2 text-green-600">‚úì</span>
                    </div>
                </div>
            `;
            
            taskDiv.remove();
            document.getElementById('tasksList').insertAdjacentHTML('beforeend', doneTaskHtml);
        }

        function checkRevolutionComplete() {
            const activeTasksCount = tasks.filter(task => task.progress < 100).length;
            
            if (activeTasksCount === 0) {
                setTimeout(() => {
                    if (confirm('Congratulations! Has your revolution been reinvented?')) {
                        archiveCurrentRevolution();
                        startNewRevolution();
                    }
                }, 500);
            }
        }

        function archiveCurrentRevolution() {
            const currentGoal = document.getElementById('revolutionGoal').value;
            const completedTasksElements = document.querySelectorAll('.task');
            const completedTasksList = Array.from(completedTasksElements).map(task => ({
                description: task.querySelector('div').textContent,
                completed: true
            }));

            completedGoals.push({
                number: currentRevolutionNumber,
                goal: currentGoal,
                tasks: completedTasksList
            });

            updateCarousel();
        }

        function startNewRevolution() {
            currentRevolutionNumber++;
            
            // Update title for next revolution
            document.querySelector('h1').innerHTML = 
                `‚ö°Ô∏è Reinventing Revolution ${currentRevolutionNumber}.0 ‚ö°Ô∏è`;
            
            // Reset current revolution
            document.getElementById('revolutionGoal').value = '';
            document.getElementById('revolutionGoal').disabled = false;
            document.getElementById('tasksList').innerHTML = '';
            document.getElementById('emojiContainer').classList.add('hidden');
            document.getElementById('tasksContainer').classList.add('hidden');
            tasks = [];
            updateEmoji(); // Reset emoji and progress display
        }

        function updateCarousel() {
            // Create carousel if it doesn't exist
            let carousel = document.getElementById('completedRevolutions');
            if (!carousel) {
                const carouselHtml = `
                    <div id="completedRevolutions" class="mt-8 bg-white rounded-lg p-6 shadow-lg">
                        <h2 class="text-2xl mb-4 fancy-text text-purple-600">Completed Revolutions</h2>
                        <div id="carouselContent"></div>
                    </div>
                `;
                document.querySelector('.max-w-2xl').insertAdjacentHTML('beforeend', carouselHtml);
                carousel = document.getElementById('completedRevolutions');
            }

            // Update carousel content
            const carouselContent = document.getElementById('carouselContent');
            carouselContent.innerHTML = completedGoals.map(revolution => `
                <div class="mb-6 p-4 border rounded-lg bg-gray-50">
                    <h3 class="text-xl font-bold mb-2">Revolution ${revolution.number}.0</h3>
                    <p class="text-gray-700 mb-2">${revolution.goal}</p>
                    <div class="pl-4">
                        ${revolution.tasks.map(task => `
                            <div class="text-gray-600">
                                ‚úì ${task.description}
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function canAddNewTask() {
            return tasks.some(task => task.progress === 100);
        }

        function updateAddTaskButton() {
            const addTaskBtn = document.getElementById('addTaskBtn');
            addTaskBtn.disabled = tasks.length >= MAX_INITIAL_TASKS && !canAddNewTask();
            addTaskBtn.style.opacity = addTaskBtn.disabled ? '0.5' : '1';
        }

        function updateEmoji() {
            const emojiFace = document.getElementById('emojiFace');
            const progressText = document.getElementById('progressText');

            if (tasks.length === 0) {
                progressText.textContent = 'Overall Progress: 0%';
                emojiFace.textContent = 'üò¢';
                return;
            }
            
            const totalProgress = tasks.reduce((sum, task) => sum + task.progress, 0) / tasks.length;
            
            if (totalProgress < 33) {
                emojiFace.textContent = 'üò¢';
            } else if (totalProgress < 66) {
                emojiFace.textContent = 'üòê';
            } else if (totalProgress < 100) {
                emojiFace.textContent = 'üôÇ';
            } else {
                emojiFace.textContent = 'üòÑ';
            }

            progressText.textContent = `Overall Progress: ${Math.round(totalProgress)}%`;
        }
    </script>
</body>
</html> 